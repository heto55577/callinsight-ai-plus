<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CallInsight AI+ - –ì–ª–∞–≤–Ω–∞—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 80px 0;
            margin-bottom: 40px;
            border-radius: 0 0 20px 20px;
        }
        .call-card {
            transition: transform 0.3s;
            margin-bottom: 20px;
        }
        .call-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            margin-bottom: 30px;
        }
        .upload-area:hover {
            background: #e9ecef;
        }
        .progress-bar {
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="hero-section">
        <div class="container">
            <h1 class="display-4">üìû CallInsight AI+</h1>
            <p class="lead">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤</p>
            <p>–ü—Ä–µ–≤—Ä–∞—â–∞–µ–º –≥–æ–ª–æ—Å–æ–≤—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–∏–Ω—Å–∞–π—Ç—ã</p>
        </div>
    </div>

    <div class="container">
        <div class="row mb-5">
            <div class="col-md-8">
                <h2>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—É–¥–∏–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</h2>
                <div class="upload-area" onclick="document.getElementById('audioFile').click()">
                    <input type="file" id="audioFile" accept=".wav,.mp3,.ogg" style="display: none;">
                    <h4>üìÅ –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</h4>
                    <p class="text-muted">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: WAV, MP3, OGG</p>
                    <p class="text-muted">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 16MB</p>
                </div>
                
                <div id="uploadStatus" class="alert" style="display: none;"></div>
                
                <button class="btn btn-primary btn-lg" onclick="analyzeAudio()" id="analyzeBtn">
                    üöÄ –ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑
                </button>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">AI-—Ñ–∏—á–∏ —Å–∏—Å—Ç–µ–º—ã</h5>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">üòä –ê–Ω–∞–ª–∏–∑ —ç–º–æ—Ü–∏–π</li>
                            <li class="list-group-item">üîë –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</li>
                            <li class="list-group-item">üö´ –§–∏–ª—å—Ç—Ä –Ω–µ—Ü–µ–Ω–∑—É—Ä–Ω–æ–π –ª–µ–∫—Å–∏–∫–∏</li>
                            <li class="list-group-item">üìä –ê–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</li>
                            <li class="list-group-item">üéØ –í—ã—è–≤–ª–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π</li>
                            <li class="list-group-item">üìã –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <h2>–ò—Å—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤</h2>
        
        {% if calls %}
        <div class="row">
            {% for call in calls %}
            <div class="col-md-4">
                <div class="card call-card">
                    <div class="card-body">
                        <h5 class="card-title">–ó–≤–æ–Ω–æ–∫ #{{ call.id }}</h5>
                        <p class="card-text">
                            <strong>–î–∞—Ç–∞:</strong> {{ call.date }}<br>
                            <strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> {{ call.duration }}<br>
                            <strong>–û—Ü–µ–Ω–∫–∞:</strong> {{ call.score }}/100
                        </p>
                        <div class="progress mb-3">
                            <div class="progress-bar bg-success call-progress" 
                                 data-score="{{ call.score }}">
                                {{ call.score }}%
                            </div>
                        </div>
                        <a href="/dashboard/{{ call.id }}" class="btn btn-primary">
                            üìä –û—Ç–∫—Ä—ã—Ç—å –¥–∞—à–±–æ—Ä–¥
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info">
            <p>–ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–µ—Ä–≤—ã–π –∞—É–¥–∏–æ—Ñ–∞–π–ª!</p>
        </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let selectedFile = null;
        
        document.getElementById('audioFile').addEventListener('change', function(e) {
            selectedFile = e.target.files[0];
            const statusDiv = document.getElementById('uploadStatus');
            
            if (selectedFile) {
                statusDiv.style.display = 'block';
                statusDiv.className = 'alert alert-success';
                statusDiv.innerHTML = `
                    <strong>‚úì –§–∞–π–ª –≤—ã–±—Ä–∞–Ω:</strong> ${selectedFile.name}<br>
                    <small>–†–∞–∑–º–µ—Ä: ${(selectedFile.size / 1024 / 1024).toFixed(2)} MB</small>
                `;
            }
        });
        
        function analyzeAudio() {
            if (!selectedFile) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª');
                return;
            }
            
            const btn = document.getElementById('analyzeBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚è≥ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º...';
            btn.disabled = true;
            
            const formData = new FormData();
            formData.append('audio_file', selectedFile);
            
            fetch('/analyze', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                } else {
                    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –¥–∞—à–±–æ—Ä–¥
                    window.location.href = `/dashboard/${data.call_id}`;
                }
            })
            .catch(error => {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: ' + error.message);
            })
            .finally(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
            });
        }
        
        // Drag and drop support
        const uploadArea = document.querySelector('.upload-area');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.background = '#e9ecef';
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.background = '#f8f9fa';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.background = '#f8f9fa';
            
            if (e.dataTransfer.files.length) {
                const file = e.dataTransfer.files[0];
                document.getElementById('audioFile').files = e.dataTransfer.files;
                
                // Trigger change event
                const event = new Event('change', { bubbles: true });
                document.getElementById('audioFile').dispatchEvent(event);
            }
        });
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —à–∏—Ä–∏–Ω—É progress bars –Ω–∞ –æ—Å–Ω–æ–≤–µ data-score
        document.addEventListener('DOMContentLoaded', function() {
            const progressBars = document.querySelectorAll('.call-progress');
            progressBars.forEach(bar => {
                const score = bar.getAttribute('data-score');
                bar.style.width = score + '%';
            });
        });
    </script>
</body>
</html>